import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{V as R,a as b,d as o,c as i,s as r,u as P,e as L,b as $,p,g as T,h as j,f as B,i as U,W as q,r as G}from"../../../builtins-C5GxhwDd.js";import{W as H,a as k}from"../../../frame-comparison-CBkPASci.js";import{d as M}from"../../../dot-di-r-mUL.js";import{n as d}from"../../../normalize-BhFzRmv8.js";import{p as J}from"../../../pow-BSCluLP5.js";import{m as W}from"../../../max-DfBZmhFk.js";import{m as u}from"../../../mat4-Pkjqt0vg.js";function K(t,e){const s=new R;return s.toGLSL=()=>`reflect(${t.toGLSL()}, ${e.toGLSL()})`,s.toWGSL=()=>`reflect(${t.toWGSL()}, ${e.toWGSL()})`,s.dependencies=[t,e],s}const N=b("position",o(),0),Q=b("normal",o(),1),X=b("color",i(),2),Y=r("Transform",{P:u(),MV:u(),Mnormal:u()}),Z=r("PerDraw",{transform:Y}),h=P("perDraw",Z),V=L("v_normal",o()),w=L("v_view",o()),tt=L("v_color",i()),v=$("main",()=>{p("highp","float"),p("highp","int");const t=h.transform.MV.multiply(i(N,1));V.assign(h.transform.Mnormal.multiply(i(Q,0)).xyz),w.assign(t.xyz.negate()),tt.assign(X),T.assign(h.transform.P.multiply(t))}),et=r("Material",{ambient:o(),diffuse:o(),specular:o(),shininess:j()}),st=r("PerScene",{material:et}),f=P("perScene",st),ot=r("Light",{position:o()}),rt=r("PerPass",{light:ot}),at=P("perPass",rt),_=B("main",()=>{p("highp","float"),p("highp","int");const t=d(V),e=d(at.light.position.add(w)),s=d(w),c=f.material.diffuse.multiply(W(M(t,e),0)),g=K(e,t).negate(),a=f.material.specular.multiply(J(W(M(g,s),0),f.material.shininess));U.assign(i(f.material.ambient.add(c).add(a),1))});function D(t){const e=window.devicePixelRatio||1;t.width=t.clientWidth*e,t.height=t.clientHeight*e}document.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("webgpu");D(t);const e=await new H({canvasId:"webgpu"}).init(),s=document.getElementById("webgl");D(s);const c=new q({canvasId:"webgl",webGLcontextId:"webgl2"}),g=new Uint16Array([0,1,2,2,3,0]),a=new Float32Array([-1,-1,-.5,0,0,1,1,0,0,1,1,-1,-.5,0,0,1,0,1,0,1,1,1,-.5,0,0,1,0,0,1,1,-1,1,-.5,0,0,1,1,1,1,1]),l={transform:{P:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],MV:[.5,0,0,0,0,.5,0,0,0,0,.5,0,0,0,0,1],Mnormal:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},n={light:{position:[0,0,0]}},C={material:{ambient:[.1,0,0],diffuse:[.5,0,0],specular:[1,1,1],shininess:4}},I=v.toGLSL(2),A=_.toGLSL(2),E=v.toWGSL({convertDepth:!0}),F=_.toWGSL(v),z={vertex:{glsl:I,wgsl:E},fragment:{glsl:A,wgsl:F,targets:[{blend:{}}]},primitive:{topology:"triangle-list"}},O={bindingResources:{PerDraw:{value:l},PerPass:{value:n},PerScene:{value:C}},vertices:{vertices:{position:{data:a,format:"float32x3",arrayStride:40,offset:0},normal:{data:a,format:"float32x3",arrayStride:40,offset:12},color:{data:a,format:"float32x4",arrayStride:40,offset:24}}}.vertices,indices:g,draw:{__type__:"DrawIndexed",indexCount:6,firstIndex:0},pipeline:z},S={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:[O]}]}]};let m=0,y=!0;function x(){m+=.01,l.transform.MV[0]=.1*Math.cos(m)+.4,G(l.transform).MV=l.transform.MV.concat(),n.light.position[0]=Math.cos(3*m),n.light.position[1]=Math.sin(6*m),G(n.light).position=n.light.position.concat(),c.submit(S),e.submit(S),y&&(y=!1,k(c,e,s,t,0)),requestAnimationFrame(x)}x()});
