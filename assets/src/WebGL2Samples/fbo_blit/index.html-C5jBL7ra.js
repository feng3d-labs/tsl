import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as y,v as u,u as _,e as C,b as M,p as l,g as S,c as j,f as z,W as T}from"../../../builtins-C5GxhwDd.js";import{s as U}from"../../../sampler2D-DSRZ_QT6.js";import{t as H}from"../../../texture-D0-A-o9X.js";import{r as N}from"../../../return-DhHkPme9.js";import{m as Y}from"../../../mat4-Pkjqt0vg.js";function Z(t){return new Promise((r,f)=>{const o=new Image;o.onload=()=>r(o),o.onerror=d=>f(d),o.src=t})}const k=y("position",u(),0),q=y("texcoord",u(),4),J=_("MVP",Y()),F=C("v_st",u()),m=M("main",()=>{l("highp","float"),l("highp","int"),F.assign(q),S.assign(J.multiply(j(k,0,1)))}),K=U(_("diffuse")),w=z("main",()=>{l("highp","float"),l("highp","int"),N(H(K,F))});function Q(t){const r=window.devicePixelRatio||1;t.width=t.clientWidth*r,t.height=t.clientHeight*r}document.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("webgl");Q(t);const r=new T({canvasId:"webgl",webGLcontextId:"webgl2"}),f=m.toGLSL(2),o=w.toGLSL(2),d=m.toWGSL(),L=w.toWGSL(m),g={vertex:{glsl:f,wgsl:d},fragment:{glsl:o,wgsl:L,targets:[{blend:{}}]},primitive:{topology:"triangle-list"}},R=new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),P=new Float32Array([0,1,1,1,1,0,1,0,0,0,0,1]),p={position:{data:R,format:"float32x2"},texcoord:{data:P,format:"float32x2"}},i=await Z("./images/Di-3d.png"),e={x:i.width,y:i.height},B={descriptor:{size:[i.width,i.height],format:"rgba8unorm"},sources:[{image:i,flipY:!0}]},E={minFilter:"linear",magFilter:"linear"},x={descriptor:{format:"rgba8unorm",size:[e.x,e.y]}},G={minFilter:"linear",magFilter:"linear"},V={texture:{descriptor:{format:"rgba8unorm",size:[e.x,e.y]}}},I={viewport:{x:0,y:0,width:e.x,height:e.y},pipeline:g,bindingResources:{MVP:{value:new Float32Array([.8,0,0,0,0,.8,0,0,0,0,.8,0,0,0,0,1])},diffuse:{texture:B,sampler:E}},vertices:p,draw:{__type__:"DrawVertex",firstVertex:0,vertexCount:6}},b={descriptor:{colorAttachments:[{view:V,clearValue:[.3,.3,.3,1]}]},renderPassObjects:[I]},W={descriptor:{colorAttachments:[{view:{texture:x,baseMipLevel:0},clearValue:[.7,0,0,1]}]}},h=[],s=4,c=2;for(let n=0;n<s;n++)for(let a=0;a<s;a++)(a+n)%2||h.push([0,0,e.x,e.y,e.x/s*(a+0)+c,e.x/s*(n+0)+c,e.y/s*(a+1)-c,e.y/s*(n+1)-c,"COLOR_BUFFER_BIT","LINEAR"]);const A={__type__:"BlitFramebuffer",read:b.descriptor,draw:W.descriptor,blitFramebuffers:h},D={viewport:{x:0,y:0,width:t.width,height:t.height},pipeline:g,bindingResources:{MVP:{value:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},diffuse:{texture:x,sampler:G}},vertices:p,draw:{__type__:"DrawVertex",firstVertex:0,vertexCount:6}},O={descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:[D]};r.submit({commandEncoders:[{passEncoders:[b,A,O]}]});const v=document.getElementById("comparison-result");v&&(v.innerHTML=`
            <div style="margin-bottom: 8px; font-weight: bold; color: #4a90e2;">仅 WebGL 支持</div>
            <div>BlitFramebuffer 是 WebGL 特有功能，WebGPU 暂不支持此操作</div>
        `)});
