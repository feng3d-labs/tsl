import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as L,d as x,v as T,u,e as D,b as Z,p as y,c as v,g as J,h as K,q as Q,f as tt,W as et,r as R}from"../../../builtins-C5GxhwDd.js";import{W as ot,a as at}from"../../../frame-comparison-CBkPASci.js";import{v as O}from"../../../var-BrV_KNjZ.js";import{s as nt}from"../../../sampler2D-DSRZ_QT6.js";import{t as st}from"../../../texture-D0-A-o9X.js";import{d as rt}from"../../../dot-di-r-mUL.js";import{n as j}from"../../../normalize-BhFzRmv8.js";import{c as it}from"../../../clamp-DYFz6aCQ.js";import{m as W}from"../../../mat4-Pkjqt0vg.js";import{c as w,t as lt,p as ct,a as mt,i as dt,r as pt,b as gt,d as ut,m as ft}from"../../../mat4-Lq7FX_53.js";import{c as ht,s as wt}from"../../../vec3-BLfYq55O.js";import"../../../wgslKeywords-TYZDccpG.js";import"../../../common-C8IKy_GC.js";const _={};(function(){let t=0,o=0,n=0;const d=new DataView(new ArrayBuffer(8)),s=new DataView(new ArrayBuffer(2)),i=1/1024;function b(e){if(e===0){o=0,t=0;return}d.setFloat64(0,e),n=d.getUint32(0)>>>20&2047,n===0&&(d.setFloat64(0,e*Math.pow(2,64)),n=(d.getUint32(0)>>>20&2047)-64),t=n-1022,o=l(e,-t)}function l(e,a){return a>1023?e*Math.pow(2,1023)*Math.pow(2,a-1023):a<-1074?e*Math.pow(2,-1074)*Math.pow(2,a+1074):e*Math.pow(2,a)}let f,h,p,c;_.encodeFloat16AsInt16=function(e){return b(e),o===0?(s.setInt16(0,0),s.getInt16(0)):(f=o<0?1:0,h=f<<15,p=0,c=0,t<=-14?(c=Math.abs(o*Math.pow(2,t+14))/i,s.setInt16(0,h+p+c),s.getInt16(0)):(o<1&&(o=o*2-1,t=t-1),p=t+15<<10,c=Math.abs(o)/i,s.setInt16(0,h+p+c),s.getInt16(0)))};let m;_.Float16Array=function(e){const a=new Int16Array(new ArrayBuffer(2*e.length)),r=new Array(e.length);for(m=0;m<e.length;++m)r[m]=_.encodeFloat16AsInt16(e[m]);return a.set(r,0),a}})();const vt=L("a_position",x(),1),_t=L("a_texCoord",T(),2),xt=L("a_normal",x(),3),bt=u("u_model",W()),It=u("u_modelInvTrans",W()),F=u("u_viewProj",W()),yt=u("u_lightPosition",x()),q=D("v_texCoord",T()),H=D("v_normal",x()),Y=D("v_lightDirection",x()),A=Z("main",()=>{y("highp","float"),y("highp","int");const t=O("modelPosition",bt.multiply(v(vt,1)).xyz);Y.assign(F.multiply(v(yt.subtract(t),1)).xyz),J.assign(F.multiply(v(t,1))),H.assign(F.multiply(It).multiply(v(xt,0)).xyz),q.assign(_t)}),Mt=nt(u("s_tex2D")),Pt=u("u_ambient",K()),C=v(Q(0,"color")),z=tt("main",()=>{y("highp","float"),y("highp","int"),C.assign(st(Mt,q));const t=O("lightIntensity",rt(j(H),j(Y)));t.assign(it(t,0,1).add(Pt)),C.assign(C.multiply(t))});function Ft(t,o){const n=new Image;return n.onload=function(){o(n)},n.src=t,n}document.addEventListener("DOMContentLoaded",async()=>{const t=A.toGLSL(2),o=z.toGLSL(2),n=A.toWGSL({convertDepth:!0}),d=z.toWGSL(A),s=window.devicePixelRatio||1,i=document.getElementById("webgpu");i.width=i.clientWidth*s,i.height=i.clientHeight*s;const b=await new ot({canvasId:"webgpu"}).init(),l=document.getElementById("webgl");l.width=l.clientWidth*s,l.height=l.clientHeight*s;const f=new et({canvasId:"webgl",webGLcontextId:"webgl2"}),h=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),p=_.Float16Array([0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]),c=_.Float16Array([0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),m=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),e={a_position:{data:h,format:"float32x3"},a_normal:{data:p,format:"float16x4"},a_texCoord:{data:c,format:"float16x2"}},a=w(),r=w(),G=ht();wt(G,0,0,-10),lt(r,a,G);const S=w();ct(S,.785,1,1,1e3);const E=w(),I=w();mt(I,a),dt(I,I);const $=[0,0,5];Ft("./images/Di-3d.png",M=>{const k={descriptor:{format:"rgba8unorm",mipLevelCount:1,size:[M.width,M.height]},sources:[{image:M,flipY:!1}]},N={minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},P={pipeline:{vertex:{glsl:t,wgsl:n},fragment:{glsl:o,wgsl:d},depthStencil:{depthCompare:"less",depthWriteEnabled:!0},primitive:{topology:"triangle-list",cullFace:"back"}},bindingResources:{u_model:{value:a},u_modelInvTrans:{value:I},u_lightPosition:{value:$},u_ambient:{value:.1}},vertices:e,indices:m,draw:{__type__:"DrawIndexed",indexCount:36}},X={descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}],depthStencilAttachment:{depthClearValue:1,depthLoadOp:"clear"}},renderPassObjects:[P]},g=[0,0,0];let U=!1;function V(){g[0]=.005,g[1]=.003,g[2]=9e-4,pt(r,r,g[0]*Math.PI),gt(r,r,g[1]*Math.PI),ut(r,r,g[2]*Math.PI),ft(E,S,r),R(P.bindingResources).u_viewProj={value:E},R(P.bindingResources).s_tex2D={texture:k,sampler:N};const B={commandEncoders:[{passEncoders:[X]}]};f.submit(B),b.submit(B),U||(U=!0,at(f,b,l,i,0)),requestAnimationFrame(V)}requestAnimationFrame(V)})});
