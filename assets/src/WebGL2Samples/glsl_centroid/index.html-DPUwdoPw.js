import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{t as X,V as j,w as z,F as yt,x as B,a as p,v as d,h as x,u as G,e as b,b as y,p as r,g as V,c as n,q as K,f as W,W as Vt}from"../../../builtins-C5GxhwDd.js";import{W as Wt,a as Ft}from"../../../frame-comparison-CBkPASci.js";import{s as _t}from"../../../sampler2D-DSRZ_QT6.js";import{t as Ct}from"../../../texture-D0-A-o9X.js";import{s as Q}from"../../../select-DnGDa-4t.js";import{m as tt}from"../../../mix-vZRoDtYO.js";import{m as et}from"../../../mat4-Pkjqt0vg.js";import{c as N,s as Pt}from"../../../mat4-Lq7FX_53.js";import{c as At,s as Mt}from"../../../vec3-BLfYq55O.js";import"../../../common-C8IKy_GC.js";function st(t){if(t instanceof X){const e=new X(0,0);return e.toGLSL=()=>`sqrt(${t.toGLSL()})`,e.toWGSL=()=>`sqrt(${t.toWGSL()})`,e.dependencies=[t],e}if(t instanceof j){const e=new j;return e.toGLSL=()=>`sqrt(${t.toGLSL()})`,e.toWGSL=()=>`sqrt(${t.toWGSL()})`,e.dependencies=[t],e}if(t instanceof z){const e=new z;return e.toGLSL=()=>`sqrt(${t.toGLSL()})`,e.toWGSL=()=>`sqrt(${t.toWGSL()})`,e.dependencies=[t],e}const o=new yt;return o.toGLSL=()=>`sqrt(${typeof t=="number"?B(t):t.toGLSL()})`,o.toWGSL=()=>`sqrt(${typeof t=="number"?B(t):t.toWGSL()})`,o.dependencies=typeof t=="number"?[]:[t],o}const ot=p("position",d(),0),rt=p("data",x(),6),nt=G("MVP",et()),v=b("v_attribute",x()),h=y("main",()=>{r("highp","float"),r("highp","int"),V.assign(nt.multiply(n(ot,0,1))),v.assign(rt)}),at=n(K(0,"color")),U=W("main",()=>{r("highp","float"),r("highp","int");const t=n(0,0,1,1),o=n(1,1,0,1);at.assign(Q(v.greaterThanOrEqual(0),tt(t,o,st(v)),o))}),S=b("v_attribute",x(),{sampling:"centroid"}),f=y("main",()=>{r("highp","float"),r("highp","int"),V.assign(nt.multiply(n(ot,0,1))),S.assign(rt)}),Y=W("main",()=>{r("highp","float"),r("highp","int");const t=n(0,0,1,1),o=n(1,1,0,1);at.assign(Q(S.greaterThanOrEqual(0),tt(t,o,st(S)),o))}),qt=p("position",d(),0),Et=p("texcoord",d(),1),Ot=G("MVP",et()),it=b("v_st",d()),L=y("main",()=>{r("highp","float"),r("highp","int"),it.assign(Et),V.assign(Ot.multiply(n(qt,0,1)))}),It=_t(G("diffuse")),Rt=n(K(0,"color")),Z=W("main",()=>{r("highp","float"),r("highp","int"),Rt.assign(Ct(It,it))});function k(t){const o=window.devicePixelRatio||1;t.width=t.clientWidth*o,t.height=t.clientHeight*o}const w={MAX:2},J={SPLASH:2};document.addEventListener("DOMContentLoaded",async()=>{const t=h.toGLSL(2),o=U.toGLSL(2),e=h.toWGSL(),ct=U.toWGSL(h),lt=f.toGLSL(2),pt=Y.toGLSL(2),dt=f.toWGSL(),gt=Y.toWGSL(f),mt=L.toGLSL(2),ut=Z.toGLSL(2),ht=L.toWGSL(),ft=Z.toWGSL(L),F=document.getElementById("webgpu");k(F);const _=await new Wt({canvasId:"webgpu"}).init(),i=document.getElementById("webgl");k(i);const C=new Vt({canvasId:"webgl",webGLcontextId:"webgl2"}),c={x:i.width,y:i.height},g=c.x/2,P=c.y,Lt=[{x:0,y:0,width:g,height:P},{x:g,y:0,width:g,height:P}],A=[{vertex:{glsl:t,wgsl:e},fragment:{glsl:o,wgsl:ct},primitive:{topology:"triangle-list"}},{vertex:{glsl:lt,wgsl:dt},fragment:{glsl:pt,wgsl:gt},primitive:{topology:"triangle-list"}},{vertex:{glsl:mt,wgsl:ht},fragment:{glsl:ut,wgsl:ft,targets:[{blend:{}}]},primitive:{topology:"triangle-list"}}],a=.1,M=new Float32Array([a*0,a*.8,a*-.8,a*-.4,a*1,a*-.8]),q=new Float32Array([0,0,1]),wt=new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),vt=new Float32Array([0,1,1,1,1,0,1,0,0,0,0,1]),E=[{vertices:{position:{data:M,format:"float32x2"},data:{data:q,format:"float32"}}},{vertices:{position:{data:M,format:"float32x2"},data:{data:q,format:"float32"}}},{vertices:{position:{data:wt,format:"float32x2"},texcoord:{data:vt,format:"float32x2"}}}],O={x:c.x,y:c.y},l=[],I=[];for(let s=0;s<w.MAX;++s)l[s]={descriptor:{format:"rgba8unorm",size:[O.x,O.y]}},I[s]={minFilter:"nearest",magFilter:"nearest"};const St=[{colorAttachments:[{view:{texture:l[0],baseMipLevel:0},clearValue:[0,0,0,1],loadOp:"clear"}],sampleCount:4},{colorAttachments:[{view:{texture:l[1],baseMipLevel:0},clearValue:[0,0,0,1],loadOp:"clear"}],sampleCount:4}],m=[],R=N();for(let s=0;s<w.MAX;++s){const bt={descriptor:St[s],renderPassObjects:[{pipeline:A[s],bindingResources:{MVP:{value:R}},vertices:E[s].vertices,draw:{__type__:"DrawVertex",vertexCount:3}}]};m.push(bt)}const $=[],xt={pipeline:A[J.SPLASH],vertices:E[J.SPLASH].vertices,draw:{__type__:"DrawVertex",vertexCount:6}},D=At(),u=.8/a;Mt(D,u,u,u);const T=N();Pt(T,R,D);for(let s=0;s<w.MAX;++s)$.push({...xt,viewport:Lt[s],bindingResources:{MVP:{value:T},diffuse:{texture:l[s],sampler:I[s]}},draw:{__type__:"DrawVertex",vertexCount:6}});const Gt={descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:$};m.push(Gt);const H={commandEncoders:[{passEncoders:m}]};C.submit(H),_.submit(H),Ft(C,_,i,F,0)});
