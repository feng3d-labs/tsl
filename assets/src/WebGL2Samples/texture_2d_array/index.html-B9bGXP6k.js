import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as b,v as c,u as m,e as D,b as P,p as o,g as U,c as N,o as V,n as R,f as z,W as O,r as j}from"../../../builtins-C5GxhwDd.js";import{W as B,a as T}from"../../../frame-comparison-CBkPASci.js";import{t as q}from"../../../texture-D0-A-o9X.js";import{r as H}from"../../../return-DhHkPme9.js";import{m as Z}from"../../../mat4-Pkjqt0vg.js";const k=b("position",c(),0),J=b("texcoord",c(),4),K=m("MVP",Z()),y=D("v_st",c()),i=P("main",()=>{o("highp","float"),o("highp","int"),y.assign(J),U.assign(K.multiply(N(k,0,1)))}),Q=V(m("diffuse")),X=m("layer",R()),v=z("main",()=>{o("highp","float"),o("highp","int"),o("highp","sampler2DArray"),H(q(Q,y,X))});function Y(t,a){const r=new Image;return r.onload=function(){a(r)},r.src=t,r}function x(t){const a=window.devicePixelRatio||1;t.width=t.clientWidth*a,t.height=t.clientHeight*a}document.addEventListener("DOMContentLoaded",async()=>{const t=i.toGLSL(2),a=v.toGLSL(2),r=i.toWGSL({convertDepth:!0}),_=v.toWGSL(i),l=document.getElementById("webgpu");x(l);const g=await new B({canvasId:"webgpu"}).init(),d=document.getElementById("webgl");x(d);const p=new O({canvasId:"webgl",webGLcontextId:"webgl2"});Y("./images/di-animation-array.jpg",I=>{const e={width:960,height:540},n=document.createElement("canvas");n.width=e.width,n.height=e.height*3;const u=n.getContext("2d");u.drawImage(I,0,0);const M=u.getImageData(0,0,e.width,e.height*3),A=new Uint8Array(M.data.buffer),G=new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),S=new Float32Array([0,1,1,1,1,0,1,0,0,0,0,1]),E={vertices:{position:{data:G,format:"float32x2"},texcoord:{data:S,format:"float32x2"}}},F={descriptor:{size:[e.width,e.height,3],dimension:"2d-array",format:"rgba8unorm"},sources:[{__type__:"TextureDataSource",size:[e.width,e.height,3],data:A}]},L={minFilter:"linear",magFilter:"linear"},W=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h={pipeline:{vertex:{glsl:t,wgsl:r},fragment:{glsl:a,wgsl:_},primitive:{topology:"triangle-list"}},bindingResources:{MVP:{value:W},diffuse:{texture:F,sampler:L},layer:{value:0}},vertices:E.vertices,draw:{__type__:"DrawVertex",vertexCount:6}},f={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[1,1,1,1],loadOp:"clear"}]},renderPassObjects:[h]}]}]};let s=0,w=!0;(function C(){j(h.bindingResources).layer={value:s},p.submit(f),g.submit(f),w&&(w=!1,T(p,g,d,l,0)),s=(s+1)%3,setTimeout(()=>{requestAnimationFrame(C)},200)})()})});
