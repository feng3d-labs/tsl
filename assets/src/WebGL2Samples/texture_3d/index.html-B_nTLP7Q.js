import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as N,v as k,u as Q,e as tt,d as ot,b as nt,p as D,c as Z,g as et,z as rt,f as st,W as at,r as it}from"../../../builtins-C5GxhwDd.js";import{W as ct,a as lt}from"../../../frame-comparison-CBkPASci.js";import{c as O,a as j,b as q,d as u}from"../../../vec3-BLfYq55O.js";import{t as mt}from"../../../texture-D0-A-o9X.js";import{r as ft}from"../../../return-DhHkPme9.js";import{m as ht}from"../../../mat4-Pkjqt0vg.js";import"../../../common-C8IKy_GC.js";function pt(t,o){return[o[0]<t[0]?0:1,o[1]<t[1]?0:1,o[2]<t[2]?0:1]}function ut(t,o){return[o[0]<t[0]?0:1,o[1]<t[1]?0:1,o[2]<t[2]?0:1,o[3]<t[3]?0:1]}function Mt(t,o){return[o[0]<t[0]?o[0]:t[0],o[1]<t[1]?o[1]:t[1],o[2]<t[2]?o[2]:t[2]]}function dt(t,o){return[o[0]>t[0]?o[0]:t[0],o[1]>t[1]?o[1]:t[1],o[2]>t[2]?o[2]:t[2]]}function wt(t,o){return[o[0]>t[0]?o[0]:t[0],o[1]>t[1]?o[1]:t[1],o[2]>t[2]?o[2]:t[2],o[3]>t[3]?o[3]:t[3]]}function gt(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]}function vt(t){const o=.0034602076124567475;return[t[0]-Math.floor(t[0]*o)*289,t[1]-Math.floor(t[1]*o)*289,t[2]-Math.floor(t[2]*o)*289]}function bt(t){const o=.0034602076124567475;return[t[0]-Math.floor(t[0]*o)*289,t[1]-Math.floor(t[1]*o)*289,t[2]-Math.floor(t[2]*o)*289,t[3]-Math.floor(t[3]*o)*289]}function V(t){return bt([(t[0]*34+1)*t[0],(t[1]*34+1)*t[1],(t[2]*34+1)*t[2],(t[3]*34+1)*t[3]])}function _t(t){return[1.79284291400159-.85373472095314*t[0],1.79284291400159-.85373472095314*t[1],1.79284291400159-.85373472095314*t[2],1.79284291400159-.85373472095314*t[3]]}function Tt(t){const o=[.16666666666666666,.3333333333333333],A=[0,.5,1,2],d=O(),w=u(t,[o[1],o[1],o[1]]);j(d,[w,w,w],t);let r=[Math.floor(d[0]),Math.floor(d[1]),Math.floor(d[2])];const M=O();q(M,t,r);const g=u(r,[o[0],o[0],o[0]]),n=O();j(n,[g,g,g],M);const m=pt([n[1],n[2],n[0]],[n[0],n[1],n[2]]),h=[1-m[0],1-m[1],1-m[2]],a=Mt([m[0],m[1],m[2]],[h[2],h[0],h[1]]),G=dt([m[0],m[1],m[2]],[h[2],h[0],h[1]]),B=O();q(B,n,a);const S=O();j(S,[o[0],o[0],o[0]],B);const H=O();q(H,n,G);const E=O();j(E,[o[1],o[1],o[1]],H);const W=O();q(W,n,[A[1],A[1],A[1]]),r=vt(r);let i=V([r[2]+0,r[2]+a[2],r[2]+G[2],r[2]+1]);i[0]+=r[1]+0,i[1]+=r[1]+a[1],i[2]+=r[1]+G[1],i[3]+=r[1]+1,i=V(i),i[0]+=r[0]+0,i[1]+=r[0]+a[0],i[2]+=r[0]+G[0],i[3]+=r[0]+1,i=V(i);const e=[.2857143,-.9285714,.14285715],v=[i[0]-49*Math.floor(i[0]*e[2]*e[2]),i[1]-49*Math.floor(i[1]*e[2]*e[2]),i[2]-49*Math.floor(i[2]*e[2]*e[2]),i[3]-49*Math.floor(i[3]*e[2]*e[2])],y=[Math.floor(v[0]*e[2]),Math.floor(v[1]*e[2]),Math.floor(v[2]*e[2]),Math.floor(v[3]*e[2])],P=[Math.floor(v[0]-7*y[0]),Math.floor(v[1]-7*y[1]),Math.floor(v[2]-7*y[2]),Math.floor(v[3]-7*y[3])],c=[y[0]*e[0]+e[1],y[1]*e[0]+e[1],y[2]*e[0]+e[1],y[3]*e[0]+e[1]],_=[P[0]*e[0]+e[1],P[1]*e[0]+e[1],P[2]*e[0]+e[1],P[3]*e[0]+e[1]],L=[1-Math.abs(c[0])-Math.abs(_[0]),1-Math.abs(c[1])-Math.abs(_[1]),1-Math.abs(c[2])-Math.abs(_[2]),1-Math.abs(c[3])-Math.abs(_[3])],s=[c[0],c[1],_[0],_[1]],p=[c[2],c[3],_[2],_[3]],T=[Math.floor(s[0])*2+1,Math.floor(s[1])*2+1,Math.floor(s[2])*2+1,Math.floor(s[3])*2+1],x=[Math.floor(p[0])*2+1,Math.floor(p[1])*2+1,Math.floor(p[2])*2+1,Math.floor(p[3])*2+1],l=ut(L,[0,0,0,0]);l[0]=-l[0],l[1]=-l[1],l[2]=-l[2],l[3]=-l[3];const F=[s[0]+T[0]*l[0],s[2]+T[2]*l[0],s[1]+T[1]*l[1],s[3]+T[3]*l[1]],X=[p[0]+x[0]*l[2],p[2]+x[2]*l[2],p[1]+x[1]*l[3],p[3]+x[3]*l[3]];let R=[F[0],F[1],L[0]],z=[F[2],F[3],L[1]],C=[X[0],X[1],L[2]],I=[X[2],X[3],L[3]];const b=_t([u(R,R),u(z,z),u(C,C),u(I,I)]);R=[R[0]*b[0],R[1]*b[0],R[2]*b[0]],z=[z[0]*b[1],z[1]*b[1],z[2]*b[1]],C=[C[0]*b[2],C[1]*b[2],C[2]*b[2]],I=[I[0]*b[3],I[1]*b[3],I[2]*b[3]];const f=wt([.6-u(n,n),.6-u(S,S),.6-u(E,E),.6-u(W,W)],[0,0,0,0]);return f[0]*=f[0],f[1]*=f[1],f[2]*=f[2],f[3]*=f[3],42*gt([f[0]*f[0],f[1]*f[1],f[2]*f[2],f[3]*f[3]],[u(R,n),u(z,S),u(C,E),u(I,W)])}const yt=N("position",k(),0),Ft=N("in_texcoord",k(),1),At=Q("orientation",ht()),$=tt("v_texcoord",ot()),Y=nt("main",()=>{D("highp","float"),D("highp","int");const t=At.multiply(Z(Ft.subtract(k(.5,.5)),.5,1));$.assign(t.xyz),et.assign(Z(yt,0,1))}),Lt=rt(Q("diffuse")),J=st("main",()=>{D("highp","float"),D("highp","int"),D("highp","sampler3D"),ft(mt(Lt,$))});function K(t){const o=window.devicePixelRatio||1;t.width=t.clientWidth*o,t.height=t.clientHeight*o}function U(t,o,A){const d=Math.cos(t),w=Math.sin(t),r=Math.cos(o),M=Math.sin(o),g=Math.cos(A),n=Math.sin(A);return[d*r,d*M*n-w*g,d*M*g+w*n,0,w*r,w*M*n+d*g,w*M*g-d*n,0,-M,r*n,r*g,0,0,0,0,1]}document.addEventListener("DOMContentLoaded",async()=>{const t=Y.toGLSL(2),o=J.toGLSL(2),A=Y.toWGSL({convertDepth:!0}),d=J.toWGSL(Y),w=document.getElementById("webgpu");K(w);const r=await new ct({canvasId:"webgpu"}).init(),M=document.getElementById("webgl");K(M);const g=new at({canvasId:"webgl",webGLcontextId:"webgl2"}),n={x:M.width,y:M.height},m={TOP_LEFT:0,TOP_RIGHT:1,BOTTOM_RIGHT:2,BOTTOM_LEFT:3,MAX:4},h=new Array(m.MAX);h[m.BOTTOM_LEFT]={x:0,y:0,z:n.x/2,w:n.y/2},h[m.BOTTOM_RIGHT]={x:n.x/2,y:0,z:n.x/2,w:n.y/2},h[m.TOP_RIGHT]={x:n.x/2,y:n.y/2,z:n.x/2,w:n.y/2},h[m.TOP_LEFT]={x:0,y:n.y/2,z:n.x/2,w:n.y/2};const a=32,G=new Uint8Array(a*a*a);for(let s=0;s<a;++s)for(let p=0;p<a;++p)for(let T=0;T<a;++T)G[T+p*a+s*a*a]=Tt([T,p,s])*256;const B={descriptor:{size:[a,a,a],dimension:"3d",format:"r8unorm",generateMipmap:!0},sources:[{__type__:"TextureDataSource",mipLevel:0,size:[a,a,a],data:G}]},S={lodMinClamp:0,lodMaxClamp:Math.log2(a),minFilter:"linear",magFilter:"linear",mipmapFilter:"linear"},H=new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),E=new Float32Array([0,1,1,1,1,0,1,0,0,0,0,1]),e={pipeline:{vertex:{glsl:t,wgsl:A},fragment:{glsl:o,wgsl:d},primitive:{topology:"triangle-list"}},bindingResources:{diffuse:{texture:B,sampler:S}},vertices:{vertices:{position:{data:H,format:"float32x2"},in_texcoord:{data:E,format:"float32x2"}}}.vertices,draw:{__type__:"DrawVertex",vertexCount:6}},v=[];for(let s=0;s<m.MAX;++s)v.push({...e,viewport:{x:h[s].x,y:h[s].y,width:h[s].z,height:h[s].w}});const P={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:v}]}]},c=[0,0,0];let _=!0;function L(){c[0]+=.02,c[1]+=.01,c[2]+=.005;const s=new Float32Array(U(c[0],0,0)),p=new Float32Array(U(0,c[1],0)),T=new Float32Array(U(0,0,c[2])),x=new Float32Array(U(c[0],c[1],c[2])),l=[s,p,T,x];for(let F=0;F<m.MAX;++F)it(v[F].bindingResources).orientation={value:l[F]};g.submit(P),r.submit(P),_&&(_=!1,lt(g,r,M,w,0)),requestAnimationFrame(L)}requestAnimationFrame(L)});
