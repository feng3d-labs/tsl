import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as k,d as g,v as H,u as F,e as N,b as re,p as d,c as L,g as ie,f as ce,W as me,r as X}from"../../../builtins-C5GxhwDd.js";import{W as le,a as de}from"../../../frame-comparison-CBkPASci.js";import{s as pe}from"../../../sampler2D-DSRZ_QT6.js";import{t as ue}from"../../../texture-D0-A-o9X.js";import{d as h,a as M,c as ge}from"../../../cross-D7V0moss.js";import{r as fe}from"../../../return-DhHkPme9.js";import{n as ve}from"../../../normalize-BhFzRmv8.js";import{m as xe}from"../../../mix-vZRoDtYO.js";import{m as Z}from"../../../mat4-Pkjqt0vg.js";import{c as u,t as we,p as be,r as R,b as O,s as he,m as Me,d as ye}from"../../../mat4-Lq7FX_53.js";import{c as U,s as V}from"../../../vec3-BLfYq55O.js";import"../../../common-C8IKy_GC.js";const $=k("position",g(),0),Le=k("texcoord",H(),4),j=F("mvMatrix",Z()),Fe=F("pMatrix",Z()),J=N("v_uv",H()),n=N("v_position",g()),y=re("main",()=>{d("highp","float"),d("highp","int"),J.assign(Le),n.assign(j.multiply(L($,1)).xyz),ie.assign(Fe.multiply(j).multiply(L($,1)))}),Ie=pe(F("diffuse")),q=ce("main",()=>{d("highp","float"),d("highp","int"),d("highp","sampler2D");const t=ue(Ie,J),s=g(h(n.x),h(n.y),h(n.z)),i=g(M(n.x),M(n.y),M(n.z)),o=ve(ge(s,i));fe(xe(t,L(o,1),.5))});function B(t){const s=window.devicePixelRatio||1;t.width=t.clientWidth*s,t.height=t.clientHeight*s}function Ee(t){return new Promise((s,i)=>{const o=new Image;o.onload=()=>s(o),o.onerror=i,o.src=t})}document.addEventListener("DOMContentLoaded",async()=>{const t=y.toGLSL(2),s=q.toGLSL(2),i=y.toWGSL({convertDepth:!0}),o=q.toWGSL(y),c=document.getElementById("webgpu");B(c);const I=await new le({canvasId:"webgpu"}).init(),m=document.getElementById("webgl");B(m);const E=new me({canvasId:"webgl",webGLcontextId:"webgl2"}),K=await Ee("./images/Di-3d.png"),Q={descriptor:{format:"rgba8unorm",mipLevelCount:1,size:[512,512]},sources:[{image:K,flipY:!1}]},T={minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},ee=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),te=new Float32Array([0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),se=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),oe={vertex:{glsl:t,wgsl:i},fragment:{glsl:s,wgsl:o,targets:[{}]},depthStencil:{},primitive:{topology:"triangle-list",cullFace:"back"}},ae=u(),e=u(),P=U();V(P,0,0,-10),we(e,ae,P);const f=u();be(f,.785,1,1,1e3);const v={pipeline:oe,bindingResources:{mvMatrix:{value:e},pMatrix:{value:f},diffuse:{texture:Q,sampler:T}},vertices:{position:{data:ee,format:"float32x3"},texcoord:{data:te,format:"float32x2"}},indices:se,draw:{__type__:"DrawIndexed",indexCount:36}},_={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:[v]}]}]},r=[0,0,0];let x=!1,w=0,b=0;const C=l=>{x=!0,w=l.clientX,b=l.clientY},G=()=>{x=!1},W=l=>{if(!x)return;const Y=l.clientX,z=l.clientY,p=Y-w,ne=z-b,a=u();R(a,a,p/100),O(a,a,ne/100);const A=U();V(A,1+p/1e3,1+p/1e3,1+p/1e3),he(a,a,A),Me(e,e,a),w=Y,b=z};m.addEventListener("mousedown",C),m.addEventListener("mouseup",G),m.addEventListener("mousemove",W),c.addEventListener("mousedown",C),c.addEventListener("mouseup",G),c.addEventListener("mousemove",W);let D=!1;function S(){r[0]=2e-4,r[1]=1e-4,r[2]=5e-5,R(e,e,r[0]*Math.PI),O(e,e,r[1]*Math.PI),ye(e,e,r[2]*Math.PI),X(v.bindingResources).mvMatrix={value:e},X(v.bindingResources).pMatrix={value:f},E.submit(_),I.submit(_),D||(D=!0,requestAnimationFrame(()=>{de(E,I,m,c,1)})),requestAnimationFrame(S)}S()});
