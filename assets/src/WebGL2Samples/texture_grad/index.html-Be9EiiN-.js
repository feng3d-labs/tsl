import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{w as me,a as K,d as L,v as I,u as $,e as Q,c as b,q as le,b as de,p as u,g as ue,f as pe,W as ge,r as U}from"../../../builtins-C5GxhwDd.js";import{W as fe,a as ve}from"../../../frame-comparison-CBkPASci.js";import{l as m}from"../../../let-Czo32qSi.js";import{s as xe}from"../../../sampler2D-DSRZ_QT6.js";import{t as we}from"../../../textureSize-DF-iDVy_.js";import{d as f,a as v,c as Le}from"../../../cross-D7V0moss.js";import{n as be}from"../../../normalize-BhFzRmv8.js";import{m as he}from"../../../mix-vZRoDtYO.js";import{m as T}from"../../../mat4-Pkjqt0vg.js";import{c as x,t as Me,p as ye,r as V,b as q,s as Ge,m as Se,d as We}from"../../../mat4-Lq7FX_53.js";import{c as j,s as B}from"../../../vec3-BLfYq55O.js";import"../../../wgslKeywords-TYZDccpG.js";import"../../../common-C8IKy_GC.js";function Fe(e,t,a,s){const o=new me;return o.toGLSL=()=>`textureGrad(${e.uniform.name}, ${t.toGLSL()}, ${a.toGLSL()}, ${s.toGLSL()})`,o.toWGSL=()=>`textureSampleGrad(${e.uniform.name}_texture, ${e.uniform.name}, ${t.toWGSL()}, ${a.toWGSL()}, ${s.toWGSL()})`,o.dependencies=[e,t,a,s],o}const N=K("position",L(),0),Ie=K("texcoord",I(),4),k=$("mvMatrix",T()),$e=$("pMatrix",T()),w=Q("v_uv",I()),i=Q("vPosition",L()),W=b(le(0,"color")),F=de("main",()=>{u("highp","float"),u("highp","int"),w.assign(Ie),i.assign(k.multiply(b(N,1)).xyz),ue.assign($e.multiply(k).multiply(b(N,1)))}),H=xe($("diffuse")),Z=pe("main",()=>{u("highp","float"),u("highp","int"),u("highp","sampler2D");const e=m("size",I(we(H,0))),t=m("dx",f(w.multiply(e))),a=m("dy",v(w.multiply(e)));W.assign(Fe(H,w,t,a));const s=m("fdx",L(f(i.x),f(i.y),f(i.z))),o=m("fdy",L(v(i.x),v(i.y),v(i.z))),p=m("N",be(Le(s,o)));W.assign(he(W,b(p,1),.5))});function J(e){const t=window.devicePixelRatio||1;e.width=e.clientWidth*t,e.height=e.clientHeight*t}function Ee(e){return new Promise((t,a)=>{const s=new Image;s.onload=()=>t(s),s.onerror=a,s.src=e})}document.addEventListener("DOMContentLoaded",async()=>{const e=F.toGLSL(2),t=Z.toGLSL(2),a=F.toWGSL({convertDepth:!0}),s=Z.toWGSL(F),o=document.getElementById("webgpu");J(o);const p=await new fe({canvasId:"webgpu"}).init(),l=document.getElementById("webgl");J(l);const E=new ge({canvasId:"webgl",webGLcontextId:"webgl2"}),ee=await Ee("./images/Di-3d.png"),te={descriptor:{format:"rgba8unorm",mipLevelCount:1,size:[512,512]},sources:[{image:ee,flipY:!1}]},se={minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},oe=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),ne=new Float32Array([0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),ae=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),re={vertex:{glsl:e,wgsl:a},fragment:{glsl:t,wgsl:s,targets:[{}]},depthStencil:{},primitive:{topology:"triangle-list",cullFace:"back"}},ie=x(),n=x(),C=j();B(C,0,0,-10),Me(n,ie,C);const h=x();ye(h,.785,1,1,1e3);const M={pipeline:re,bindingResources:{mvMatrix:{value:n},pMatrix:{value:h},diffuse:{texture:te,sampler:se}},vertices:{position:{data:oe,format:"float32x3"},texcoord:{data:ne,format:"float32x2"}},indices:ae,draw:{__type__:"DrawIndexed",indexCount:36}},z={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:[M]}]}]},c=[0,0,0];let y=!1,G=0,S=0;const P=d=>{y=!0,G=d.clientX,S=d.clientY},_=()=>{y=!1},D=d=>{if(!y)return;const X=d.clientX,R=d.clientY,g=X-G,ce=R-S,r=x();V(r,r,g/100),q(r,r,ce/100);const O=j();B(O,1+g/1e3,1+g/1e3,1+g/1e3),Ge(r,r,O),Se(n,n,r),G=X,S=R};l.addEventListener("mousedown",P),l.addEventListener("mouseup",_),l.addEventListener("mousemove",D),o.addEventListener("mousedown",P),o.addEventListener("mouseup",_),o.addEventListener("mousemove",D);let Y=!1;function A(){c[0]=2e-4,c[1]=1e-4,c[2]=5e-5,V(n,n,c[0]*Math.PI),q(n,n,c[1]*Math.PI),We(n,n,c[2]*Math.PI),U(M.bindingResources).mvMatrix={value:n},U(M.bindingResources).pMatrix={value:h},E.submit(z),p.submit(z),Y||(Y=!0,requestAnimationFrame(()=>{ve(E,p,l,o,1)})),requestAnimationFrame(A)}A()});
