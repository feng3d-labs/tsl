import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as k,v as z,u as N,e as ot,b as et,p as _,g as nt,c as K,f as rt,d as mt,z as pt,W as ft}from"../../../builtins-C5GxhwDd.js";import{W as dt,a as ut}from"../../../frame-comparison-CBkPASci.js";import{c as E,d as c,a as B,b as X}from"../../../vec3-BLfYq55O.js";import{s as ht}from"../../../sampler2D-DSRZ_QT6.js";import{t as st}from"../../../texture-D0-A-o9X.js";import{r as at}from"../../../return-DhHkPme9.js";import{m as it}from"../../../mat4-Pkjqt0vg.js";import"../../../common-C8IKy_GC.js";function gt(t,o){return[o[0]<t[0]?0:1,o[1]<t[1]?0:1,o[2]<t[2]?0:1]}function Mt(t,o){return[o[0]<t[0]?0:1,o[1]<t[1]?0:1,o[2]<t[2]?0:1,o[3]<t[3]?0:1]}function vt(t,o){return[o[0]<t[0]?o[0]:t[0],o[1]<t[1]?o[1]:t[1],o[2]<t[2]?o[2]:t[2]]}function wt(t,o){return[o[0]>t[0]?o[0]:t[0],o[1]>t[1]?o[1]:t[1],o[2]>t[2]?o[2]:t[2]]}function bt(t,o){return[o[0]>t[0]?o[0]:t[0],o[1]>t[1]?o[1]:t[1],o[2]>t[2]?o[2]:t[2],o[3]>t[3]?o[3]:t[3]]}function St(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]}function Dt(t){const o=.0034602076124567475;return[t[0]-Math.floor(t[0]*o)*289,t[1]-Math.floor(t[1]*o)*289,t[2]-Math.floor(t[2]*o)*289]}function _t(t){const o=.0034602076124567475;return[t[0]-Math.floor(t[0]*o)*289,t[1]-Math.floor(t[1]*o)*289,t[2]-Math.floor(t[2]*o)*289,t[3]-Math.floor(t[3]*o)*289]}function q(t){return _t([(t[0]*34+1)*t[0],(t[1]*34+1)*t[1],(t[2]*34+1)*t[2],(t[3]*34+1)*t[3]])}function It(t){return[1.79284291400159-.85373472095314*t[0],1.79284291400159-.85373472095314*t[1],1.79284291400159-.85373472095314*t[2],1.79284291400159-.85373472095314*t[3]]}function Et(t){const o=[.16666666666666666,.3333333333333333],l=[0,.5,1,2],I=E(),M=c(t,[o[1],o[1],o[1]]);B(I,[M,M,M],t);let n=[Math.floor(I[0]),Math.floor(I[1]),Math.floor(I[2])];const D=E();X(D,t,n);const R=c(n,[o[0],o[0],o[0]]),a=E();B(a,[R,R,R],D);const m=gt([a[1],a[2],a[0]],[a[0],a[1],a[2]]),d=[1-m[0],1-m[1],1-m[2]],u=vt([m[0],m[1],m[2]],[d[2],d[0],d[1]]),p=wt([m[0],m[1],m[2]],[d[2],d[0],d[1]]),L=E();X(L,a,u);const G=E();B(G,[o[0],o[0],o[0]],L);const V=E();X(V,a,p);const W=E();B(W,[o[1],o[1],o[1]],V);const y=E();X(y,a,[l[1],l[1],l[1]]),n=Dt(n);let r=q([n[2]+0,n[2]+u[2],n[2]+p[2],n[2]+1]);r[0]+=n[1]+0,r[1]+=n[1]+u[1],r[2]+=n[1]+p[1],r[3]+=n[1]+1,r=q(r),r[0]+=n[0]+0,r[1]+=n[0]+u[0],r[2]+=n[0]+p[0],r[3]+=n[0]+1,r=q(r);const e=[.2857143,-.9285714,.14285715],h=[r[0]-49*Math.floor(r[0]*e[2]*e[2]),r[1]-49*Math.floor(r[1]*e[2]*e[2]),r[2]-49*Math.floor(r[2]*e[2]*e[2]),r[3]-49*Math.floor(r[3]*e[2]*e[2])],v=[Math.floor(h[0]*e[2]),Math.floor(h[1]*e[2]),Math.floor(h[2]*e[2]),Math.floor(h[3]*e[2])],P=[Math.floor(h[0]-7*v[0]),Math.floor(h[1]-7*v[1]),Math.floor(h[2]-7*v[2]),Math.floor(h[3]-7*v[3])],w=[v[0]*e[0]+e[1],v[1]*e[0]+e[1],v[2]*e[0]+e[1],v[3]*e[0]+e[1]],g=[P[0]*e[0]+e[1],P[1]*e[0]+e[1],P[2]*e[0]+e[1],P[3]*e[0]+e[1]],T=[1-Math.abs(w[0])-Math.abs(g[0]),1-Math.abs(w[1])-Math.abs(g[1]),1-Math.abs(w[2])-Math.abs(g[2]),1-Math.abs(w[3])-Math.abs(g[3])],b=[w[0],w[1],g[0],g[1]],S=[w[2],w[3],g[2],g[3]],A=[Math.floor(b[0])*2+1,Math.floor(b[1])*2+1,Math.floor(b[2])*2+1,Math.floor(b[3])*2+1],j=[Math.floor(S[0])*2+1,Math.floor(S[1])*2+1,Math.floor(S[2])*2+1,Math.floor(S[3])*2+1],s=Mt(T,[0,0,0,0]);s[0]=-s[0],s[1]=-s[1],s[2]=-s[2],s[3]=-s[3];const O=[b[0]+A[0]*s[0],b[2]+A[2]*s[0],b[1]+A[1]*s[1],b[3]+A[3]*s[1]],U=[S[0]+j[0]*s[2],S[2]+j[2]*s[2],S[1]+j[1]*s[3],S[3]+j[3]*s[3]];let Z=[O[0],O[1],T[0]],x=[O[2],O[3],T[1]],C=[U[0],U[1],T[2]],F=[U[2],U[3],T[3]];const f=It([c(Z,Z),c(x,x),c(C,C),c(F,F)]);Z=[Z[0]*f[0],Z[1]*f[0],Z[2]*f[0]],x=[x[0]*f[1],x[1]*f[1],x[2]*f[1]],C=[C[0]*f[2],C[1]*f[2],C[2]*f[2]],F=[F[0]*f[3],F[1]*f[3],F[2]*f[3]];const i=bt([.6-c(a,a),.6-c(G,G),.6-c(W,W),.6-c(y,y)],[0,0,0,0]);return i[0]*=i[0],i[1]*=i[1],i[2]*=i[2],i[3]*=i[3],42*St([i[0]*i[0],i[1]*i[1],i[2]*i[2],i[3]*i[3]],[c(Z,a),c(x,G),c(C,W),c(F,y)])}const Lt=k("position",z(),0),Gt=k("texcoord",z(),4),Zt=N("MVP",it()),ct=ot("v_st",z()),Y=et("main",()=>{_("highp","float"),_("highp","int"),ct.assign(Gt),nt.assign(Zt.multiply(K(Lt,0,1)))}),xt=ht(N("diffuse")),Q=rt("main",()=>{_("highp","float"),_("highp","int"),at(st(xt,ct))}),Ct=k("position",z(),0),Ft=k("in_texcoord",z(),4),lt=ot("v_texcoord",mt()),J=et("main",()=>{_("highp","float"),_("highp","int");const t=it(1).multiply(K(Ft.subtract(z(.5,.5)),.5,1));lt.assign(t.xyz),nt.assign(K(Ct,0,1))}),Wt=pt(N("diffuse")),$=rt("main",()=>{_("highp","float"),_("highp","int"),_("highp","sampler3D"),at(st(Wt,lt))});function tt(t){const o=window.devicePixelRatio||1;t.width=t.clientWidth*o,t.height=t.clientHeight*o}function yt(t,o){const l=new Image;return l.onload=function(){o(l)},l.src=t,l}function Pt(){const o=new Uint8Array(32768);for(let M=0;M<32;++M)for(let n=0;n<32;++n)for(let D=0;D<32;++D)o[D+n*32+M*32*32]=Et([D,n,M])*256;const l={descriptor:{dimension:"3d",format:"r8unorm",generateMipmap:!0,mipLevelCount:Math.log2(32),size:[32,32,32]},sources:[{__type__:"TextureDataSource",size:[32,32,32],data:o}]},I={lodMinClamp:0,lodMaxClamp:Math.log2(32),minFilter:"linear",magFilter:"linear",mipmapFilter:"linear"};return{texture3D:l,sampler3D:I}}const H={LEFT:0,RIGHT:1,MAX:2};document.addEventListener("DOMContentLoaded",async()=>{const t=Y.toGLSL(2),o=Q.toGLSL(2),l=Y.toWGSL({convertDepth:!0}),I=Q.toWGSL(Y),M=J.toGLSL(2),n=$.toGLSL(2),D=J.toWGSL({convertDepth:!0}),R=$.toWGSL(J),a=document.getElementById("webgpu");tt(a);const m=await new dt({canvasId:"webgpu"}).init(),d=document.getElementById("webgl");tt(d);const u=new ft({canvasId:"webgl",webGLcontextId:"webgl2"}),p={x:d.width,y:d.height},L=new Array(H.MAX);L[H.LEFT]={x:0,y:p.y/4,width:p.x/2,height:p.y/2},L[H.RIGHT]={x:p.x/2,y:p.y/4,width:p.x/2,height:p.y/2};const G=new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),V=new Float32Array([0,1,1,1,1,0,1,0,0,0,0,1]),W={position:{data:G,format:"float32x2"},texcoord:{data:V,format:"float32x2"}},y={position:{data:G,format:"float32x2"},in_texcoord:{data:V,format:"float32x2"}},r={vertex:{glsl:t,wgsl:l},fragment:{glsl:o,wgsl:I},primitive:{topology:"triangle-list"}},e={vertex:{glsl:M,wgsl:D},fragment:{glsl:n,wgsl:R},primitive:{topology:"triangle-list"}},{texture3D:h,sampler3D:v}=Pt(),P=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);yt("./images/Di-3d.png",w=>{const g={descriptor:{format:"rgba8unorm",mipLevelCount:1,size:[512,512]},sources:[{image:w,flipY:!1}]},b={pipeline:r,bindingResources:{MVP:{value:P},diffuse:{texture:g,sampler:{minFilter:"nearest",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}},vertices:W,draw:{__type__:"DrawVertex",vertexCount:6}},S={pipeline:e,bindingResources:{diffuse:{texture:h,sampler:v}},vertices:y,draw:{__type__:"DrawVertex",vertexCount:6}},A=[{...b,viewport:L[H.LEFT]},{...S,viewport:L[H.RIGHT]}],s={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:A}]}]};u.submit(s),m.submit(s),ut(u,m,d,a,0),u.deleteTexture(g),u.deleteTexture(h),u.deleteProgram(r),u.deleteProgram(e)})});
