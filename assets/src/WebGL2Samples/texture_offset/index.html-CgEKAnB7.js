import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{w as E,a as z,v as d,u as S,e as j,b as U,p as g,g as q,c as M,A as r,q as Y,f as R,W as k}from"../../../builtins-C5GxhwDd.js";import{W as J,a as K}from"../../../frame-comparison-CBkPASci.js";import{l as s}from"../../../let-Czo32qSi.js";import{s as N}from"../../../sampler2D-DSRZ_QT6.js";import{t as T}from"../../../textureSize-DF-iDVy_.js";import{m as Q}from"../../../mat4-Pkjqt0vg.js";import"../../../wgslKeywords-TYZDccpG.js";function p(e,t,o,n){const i=new E,c=o.toString(),u=`${o}u`;return i.toGLSL=()=>`texelFetchOffset(${e.uniform.name}, ${t.toGLSL()}, ${c}, ${n.toGLSL()})`,i.toWGSL=()=>`textureLoad(${e.uniform.name}_texture, ${t.toWGSL()} + ${n.toWGSL()}, ${u})`,i.dependencies=[e,t,n],i}function x(e,t,o){const n=new E;return n.toGLSL=()=>`textureOffset(${e.uniform.name}, ${t.toGLSL()}, ${o.toGLSL()})`,n.toWGSL=()=>`textureSample(${e.uniform.name}_texture, ${e.uniform.name}, ${t.toWGSL()}, ${o.toWGSL()})`,n.dependencies=[e,t,o],n}const X=z("position",d(),0),Z=z("texcoord",d(),4),tt=S("MVP",Q()),b=j("v_st",d()),h=U("main",()=>{g("highp","float"),g("highp","int"),b.assign(Z),q.assign(tt.multiply(M(X,0,1)))}),a=N(S("diffuse")),et=S("offset",r()),A=M(Y(0,"color")),I=R("main",()=>{g("highp","float"),g("highp","int");const e=s("textureSize",T(a,0)),t=s("offsetCoord",b.add(d(et).divide(d(e)))),o=s("texel00",x(a,t,r(-1,-1))),n=s("texel10",x(a,t,r(0,-1))),i=s("texel01",x(a,t,r(-1,0))),c=s("texel11",x(a,t,r(0,0)));A.assign(o.add(n).add(i).add(c).multiply(.25))}),P=R("main",()=>{g("highp","float"),g("highp","int");const e=s("size",T(a,0)),t=s("texelCoord",r(b.multiply(d(e)))),o=s("texel00",p(a,t,0,r(-1,-1))),n=s("texel10",p(a,t,0,r(0,-1))),i=s("texel01",p(a,t,0,r(-1,0))),c=s("texel11",p(a,t,0,r(0,0)));A.assign(o.add(n).add(i).add(c).multiply(.25))});function ot(e,t){const o=new Image;return o.onload=function(){t(o)},o.src=e,o}function V(e){const t=window.devicePixelRatio||1;e.width=e.clientWidth*t,e.height=e.clientHeight*t}const w={LEFT:0,RIGHT:1};document.addEventListener("DOMContentLoaded",async()=>{const e=h.toGLSL(2),t=I.toGLSL(2),o=P.toGLSL(2),n=h.toWGSL({convertDepth:!0}),i=I.toWGSL(h),c=P.toWGSL(h),u=document.getElementById("webgpu");V(u);const y=await new J({canvasId:"webgpu"}).init(),l=document.getElementById("webgl");V(l);const m=new k({canvasId:"webgl",webGLcontextId:"webgl2"}),f=[];f[w.LEFT]={x:0,y:l.height/4,width:l.width/2,height:l.height/2},f[w.RIGHT]={x:l.width/2,y:l.height/4,width:l.width/2,height:l.height/2};const B=new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),D=new Float32Array([0,1,1,1,1,0,1,0,0,0,0,1]),W={position:{data:B,format:"float32x2"},texcoord:{data:D,format:"float32x2"}};ot("./images/Di-3d.png",L=>{const v={descriptor:{size:[L.width,L.height],format:"rgba8unorm"},sources:[{image:L,mipLevel:0,flipY:!1}]},C={minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},$=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),H=new Int32Array([100,-80]),_={vertex:{glsl:e,wgsl:n},fragment:{glsl:t,wgsl:i,targets:[{blend:{}}]},primitive:{topology:"triangle-list"}},F={vertex:{glsl:e,wgsl:n},fragment:{glsl:o,wgsl:c,targets:[{blend:{}}]},primitive:{topology:"triangle-list"}},G=[];G.push({pipeline:_,vertices:W,viewport:f[w.LEFT],bindingResources:{MVP:{value:$},diffuse:{texture:v,sampler:C},offset:{value:H}},draw:{__type__:"DrawVertex",vertexCount:6,instanceCount:1}}),G.push({pipeline:F,vertices:W,viewport:f[w.RIGHT],bindingResources:{MVP:{value:$},diffuse:{texture:v,sampler:C}},draw:{__type__:"DrawVertex",vertexCount:6,instanceCount:1}});const O={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}]},renderPassObjects:G}]}]};m.submit(O),y.submit(O),K(m,y,l,u,0),m.deleteTexture(v),m.deleteProgram(_),m.deleteProgram(F)})});
