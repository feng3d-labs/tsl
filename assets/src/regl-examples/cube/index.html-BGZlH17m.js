import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as A,d as _,v as P,u as S,e as j,b as U,g as q,c as H,f as D,W as k,r as I}from"../../../builtins-C5GxhwDd.js";import{W as B,a as O}from"../../../frame-comparison-CBkPASci.js";import{s as V}from"../../../sampler2D-DSRZ_QT6.js";import{t as J}from"../../../texture2D-DxhDwbSP.js";import{r as K}from"../../../return-DhHkPme9.js";import{m as C}from"../../../mat4-Pkjqt0vg.js";function N(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Q(e,v,f,m,t){const s=1/Math.tan(v/2),i=1/(m-t);return e[0]=s/f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(t+m)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*t*m*i,e[15]=0,e}function T(e,v,f,m){let t,s,i,r,d,g,a,c,l,n;const h=v[0],p=v[1],b=v[2],u=m[0],x=m[1],y=m[2],W=f[0],M=f[1],w=f[2];return Math.abs(h-W)<1e-6&&Math.abs(p-M)<1e-6&&Math.abs(b-w)<1e-6?N(e):(a=h-W,c=p-M,l=b-w,n=1/Math.sqrt(a*a+c*c+l*l),a*=n,c*=n,l*=n,t=x*l-y*c,s=y*a-u*l,i=u*c-x*a,n=Math.sqrt(t*t+s*s+i*i),n?(n=1/n,t*=n,s*=n,i*=n):(t=0,s=0,i=0),r=c*i-l*s,d=l*t-a*i,g=a*s-c*t,n=Math.sqrt(r*r+d*d+g*g),n?(n=1/n,r*=n,d*=n,g*=n):(r=0,d=0,g=0),e[0]=t,e[1]=r,e[2]=a,e[3]=0,e[4]=s,e[5]=d,e[6]=c,e[7]=0,e[8]=i,e[9]=g,e[10]=l,e[11]=0,e[12]=-(t*h+s*p+i*b),e[13]=-(r*h+d*p+g*b),e[14]=-(a*h+c*p+l*b),e[15]=1,e)}const X=A("position",_()),Y=A("uv",P()),Z=S("projection",C()),$=S("view",C()),F=j("vUv",P()),L=U("main",()=>{F.assign(Y),q.assign(Z.multiply($).multiply(H(X,1)))}),ee=V(S("tex")),z=D("main",()=>{K(J(ee,F))});(async()=>{const e=L.toGLSL(),v=z.toGLSL(),f=L.toWGSL(),m=z.toWGSL(L),t=window.devicePixelRatio||1,s=document.getElementById("webgpu");s.width=s.clientWidth*t,s.height=s.clientHeight*t;const i=await new B({canvasId:"webgpu"}).init(),r=document.getElementById("webgl");r.width=r.clientWidth*t,r.height=r.clientHeight*t;const d=new k({canvasId:"webgl",webGLcontextId:"webgl2"}),g=[[-.5,.5,.5],[.5,.5,.5],[.5,-.5,.5],[-.5,-.5,.5],[.5,.5,.5],[.5,.5,-.5],[.5,-.5,-.5],[.5,-.5,.5],[.5,.5,-.5],[-.5,.5,-.5],[-.5,-.5,-.5],[.5,-.5,-.5],[-.5,.5,-.5],[-.5,.5,.5],[-.5,-.5,.5],[-.5,-.5,-.5],[-.5,.5,-.5],[.5,.5,-.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,-.5,.5],[-.5,-.5,.5]],a=[[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1]],c=[[2,1,0],[2,0,3],[6,5,4],[6,4,7],[10,9,8],[10,8,11],[14,13,12],[14,12,15],[18,17,16],[18,16,19],[20,21,22],[23,20,22]],l=g.reduce((o,E)=>(E.forEach(G=>{o.push(G)}),o),[]),n=a.reduce((o,E)=>(E.forEach(G=>{o.push(G)}),o),[]),h=c.reduce((o,E)=>(E.forEach(G=>{o.push(G)}),o),[]);let p=0,b=r.clientWidth*t,u=r.clientHeight*t;const x={vertices:{position:{data:new Float32Array(l),format:"float32x3"},uv:{data:new Float32Array(n),format:"float32x2"}},indices:new Uint16Array(h),draw:{__type__:"DrawIndexed",indexCount:h.length},bindingResources:{},pipeline:{vertex:{glsl:e,wgsl:f},fragment:{glsl:v,wgsl:m},depthStencil:{depthWriteEnabled:!0}}},y={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[0,0,0,1]}],depthStencilAttachment:{depthClearValue:1}},renderPassObjects:[x]}]}]};let W=0;function M(){p++;const o=.01*p;I(x.bindingResources).view={value:T([],[5*Math.cos(o),2.5*Math.sin(o),5*Math.sin(o)],[0,0,0],[0,1,0])},I(x.bindingResources).projection={value:Q([],Math.PI/4,b/u,.01,1e3)},i.submit(y),d.submit(y),W===0&&(W++,O(d,i,r,s,0)),requestAnimationFrame(M)}const w=new Image;w.src="./peppers.png",await w.decode();const R={texture:{descriptor:{size:[w.width,w.height]},sources:[{image:w}]},sampler:{minFilter:"linear"}};I(x.bindingResources).tex=R,M()})();
