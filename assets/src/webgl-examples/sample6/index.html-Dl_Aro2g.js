import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as S,d as j,v as y,u as p,e as A,b as T,c as _,g as R,f as E,i as D,W as q,r as b}from"../../../builtins-C5GxhwDd.js";import{W as z,a as B}from"../../../frame-comparison-CBkPASci.js";import{v as H}from"../../../var-BrV_KNjZ.js";import{s as U}from"../../../sampler2D-DSRZ_QT6.js";import{t as N}from"../../../texture2D-DxhDwbSP.js";import{m as V}from"../../../mat4-Pkjqt0vg.js";import{c as v,p as k,t as J,h as M}from"../../../mat4-Lq7FX_53.js";import"../../../wgslKeywords-TYZDccpG.js";import"../../../common-C8IKy_GC.js";const K=S("aVertexPosition",j()),Q=S("aTextureCoord",y()),X=p("uModelViewMatrix",V()),Y=p("uProjectionMatrix",V()),L=A("vTextureCoord",y()),m=T("main",()=>{const e=H("position",_(K,1));R.assign(Y.multiply(X).multiply(e)),L.assign(Q)}),Z=U(p("uSampler")),C=E("main",()=>{D.assign(N(Z,L))});let u=0;document.addEventListener("DOMContentLoaded",async()=>{const e=m.toGLSL(),t=C.toGLSL(),i=m.toWGSL(),a=C.toWGSL(m),r=window.devicePixelRatio||1,n=document.getElementById("webgpu");n.width=n.clientWidth*r,n.height=n.clientHeight*r;const s=await new z({canvasId:"webgpu"}).init(),o=document.getElementById("webgl");o.width=o.clientWidth*r,o.height=o.clientHeight*r;const g=new q({canvasId:"webgl",webGLcontextId:"webgl2"}),c=$(),W=await ee("./cubetexture.png"),d={pipeline:{vertex:{glsl:e,wgsl:i},fragment:{glsl:t,wgsl:a},primitive:{topology:"triangle-list"},depthStencil:{depthCompare:"less-equal"}},vertices:{aVertexPosition:{format:"float32x3",data:c.position},aTextureCoord:{format:"float32x2",data:c.textureCoord}},indices:c.indices,draw:{__type__:"DrawIndexed",firstIndex:0,indexCount:36},bindingResources:{uSampler:W}},F={descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}],depthStencilAttachment:{depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},renderPassObjects:[d]};let x=0,f=0;function w(l){l*=.001;const G=l-x;x=l;const{projectionMatrix:I,modelViewMatrix:O}=te(n,G);b(d.bindingResources).uProjectionMatrix={value:I},b(d.bindingResources).uModelViewMatrix={value:O};const h={commandEncoders:[{passEncoders:[F]}]};s.submit(h),g.submit(h),f===0&&(f++,B(g,s,o,n,0)),requestAnimationFrame(w)}requestAnimationFrame(w)});function $(){const e=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],t=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],i=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{position:new Float32Array(e),textureCoord:new Float32Array(t),indices:new Uint16Array(i)}}async function ee(e){const t=new Image;t.src=e,await t.decode();const i=P(t.width)&&P(t.height),a={descriptor:{size:[t.width,t.height],format:"rgba8unorm",generateMipmap:i},sources:[{image:t}]};let r={};return i&&(r={addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"linear"}),{texture:a,sampler:r}}function P(e){return(e&e-1)===0}function te(e,t){const i=45*Math.PI/180,a=e.clientWidth/e.clientHeight,r=.1,n=100,s=v();k(s,i,a,r,n);const o=v();return J(o,o,[-0,0,-6]),M(o,o,u,[0,0,1]),M(o,o,u*.7,[0,1,0]),u+=t,{projectionMatrix:s,modelViewMatrix:o}}
