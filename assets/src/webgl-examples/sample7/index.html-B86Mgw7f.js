import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as b,c as v,d as m,v as N,u as g,e as F,b as z,g as E,f as D,W as q,r as x}from"../../../builtins-C5GxhwDd.js";import{W as B,a as H}from"../../../frame-comparison-CBkPASci.js";import{v as c}from"../../../var-BrV_KNjZ.js";import{s as U}from"../../../sampler2D-DSRZ_QT6.js";import{t as k}from"../../../texture2D-DxhDwbSP.js";import{r as J}from"../../../return-DhHkPme9.js";import{d as K}from"../../../dot-di-r-mUL.js";import{n as Q}from"../../../normalize-BhFzRmv8.js";import{m as X}from"../../../max-DfBZmhFk.js";import{m as M}from"../../../mat4-Pkjqt0vg.js";import{c as f,p as Y,t as Z,h as P,i as $,a as tt}from"../../../mat4-Lq7FX_53.js";import"../../../wgslKeywords-TYZDccpG.js";import"../../../common-C8IKy_GC.js";const et=b("aVertexPosition",v()),ot=b("aVertexNormal",m()),rt=b("aTextureCoord",N()),at=g("uModelViewMatrix",M(),0,0),it=g("uProjectionMatrix",M(),0,1),nt=g("uNormalMatrix",M(),0,2),G=F("vTextureCoord",N()),I=F("vLighting",m()),h=z("main",()=>{E.assign(it.multiply(at).multiply(et)),G.assign(rt);const t=c("ambientLight",m(.3)),e=c("directionalLightColor",m(1)),a=c("directionalVector",Q(m(.85,.8,.75))),n=c("transformedNormal",nt.multiply(v(ot,1))),r=c("directional",X(K(n.xyz,a),0)),i=c("lighting",t.add(e.multiply(r)));I.assign(i)}),st=U(g("uSampler")),S=D("main",()=>{const t=c("texelColor",k(st,G));J(v(t.rgb.multiply(I),t.a))});let w=0;document.addEventListener("DOMContentLoaded",async()=>{const t=h.toGLSL(),e=S.toGLSL(),a=h.toWGSL(),n=S.toWGSL(h),r=window.devicePixelRatio||1,i=document.getElementById("webgpu");i.width=i.clientWidth*r,i.height=i.clientHeight*r;const l=await new B({canvasId:"webgpu"}).init(),o=document.getElementById("webgl");o.width=o.clientWidth*r,o.height=o.clientHeight*r;const s=new q({canvasId:"webgl",webGLcontextId:"webgl2"}),d=ct(),A=await lt("./cubetexture.png"),u={pipeline:{vertex:{glsl:t,wgsl:a},fragment:{glsl:e,wgsl:n},primitive:{topology:"triangle-list"},depthStencil:{depthCompare:"less-equal"}},vertices:{aVertexPosition:{format:"float32x3",data:d.position},aVertexNormal:{format:"float32x3",data:d.normal},aTextureCoord:{format:"float32x2",data:d.textureCoord}},indices:d.indices,draw:{__type__:"DrawIndexed",firstIndex:0,indexCount:36},bindingResources:{uSampler:A}},O={descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}],depthStencilAttachment:{depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},renderPassObjects:[u]};let C=0,y=0;function L(p){p*=.001;const j=p-C;C=p;const{projectionMatrix:R,modelViewMatrix:T,normalMatrix:_}=mt(i,j);x(u.bindingResources).uProjectionMatrix={value:R},x(u.bindingResources).uModelViewMatrix={value:T},x(u.bindingResources).uNormalMatrix={value:_};const V={commandEncoders:[{passEncoders:[O]}]};l.submit(V),s.submit(V),y===0&&(y++,H(s,l,o,i,0)),requestAnimationFrame(L)}requestAnimationFrame(L)});function ct(){const t=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],e=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],a=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{position:new Float32Array(t),normal:new Float32Array(e),textureCoord:new Float32Array(a),indices:new Uint16Array(n)}}async function lt(t){const e=new Image;e.src=t,await e.decode();const a=W(e.width)&&W(e.height),n={descriptor:{size:[e.width,e.height],format:"rgba8unorm",generateMipmap:a},sources:[{image:e}]};let r={};return a||(r={addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"linear"}),{texture:n,sampler:r}}function W(t){return(t&t-1)===0}function mt(t,e){const a=45*Math.PI/180,n=t.clientWidth/t.clientHeight,r=.1,i=100,l=f();Y(l,a,n,r,i);const o=f();Z(o,o,[-0,0,-6]),P(o,o,w,[0,0,1]),P(o,o,w*.7,[0,1,0]);const s=f();return $(s,o),tt(s,s),w+=e,{projectionMatrix:l,modelViewMatrix:o,normalMatrix:s}}
