import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as y,c as L,d as m,v as F,u as f,e as N,b as R,g as B,f as D,W as H,r as u}from"../../../builtins-C5GxhwDd.js";import{W as U,a as k}from"../../../frame-comparison-CBkPASci.js";import{v as c}from"../../../var-BrV_KNjZ.js";import{s as q}from"../../../sampler2D-DSRZ_QT6.js";import{t as J}from"../../../texture2D-DxhDwbSP.js";import{r as K}from"../../../return-DhHkPme9.js";import{d as Q}from"../../../dot-di-r-mUL.js";import{n as X}from"../../../normalize-BhFzRmv8.js";import{m as Y}from"../../../max-DfBZmhFk.js";import{m as M}from"../../../mat4-Pkjqt0vg.js";import{c as v,p as Z,t as $,h as E,i as tt,a as et}from"../../../mat4-Lq7FX_53.js";import"../../../wgslKeywords-TYZDccpG.js";import"../../../common-C8IKy_GC.js";const ot=y("aVertexPosition",L()),rt=y("aVertexNormal",m()),nt=y("aTextureCoord",F()),at=f("uModelViewMatrix",M(),0,0),it=f("uProjectionMatrix",M(),0,1),st=f("uNormalMatrix",M(),0,2),z=N("vTextureCoord",F()),A=N("vLighting",m()),w=R("main",()=>{B.assign(it.multiply(at).multiply(ot)),z.assign(nt);const e=c("ambientLight",m(.3)),t=c("directionalLightColor",m(1)),i=c("directionalVector",X(m(.85,.8,.75))),r=c("transformedNormal",st.multiply(L(rt,1))),n=c("directional",Y(Q(r.xyz,i),0)),a=c("lighting",e.add(t.multiply(n)));A.assign(a)}),ct=q(f("uSampler")),_=D("main",()=>{const e=c("texelColor",J(ct,z));K(L(e.rgb.multiply(A),e.a))});let b=0;document.addEventListener("DOMContentLoaded",async()=>{const e=w.toGLSL(),t=_.toGLSL(),i=w.toWGSL(),r=_.toWGSL(w),n=window.devicePixelRatio||1,a=document.getElementById("webgpu");a.width=a.clientWidth*n,a.height=a.clientHeight*n;const l=await new U({canvasId:"webgpu"}).init(),o=document.getElementById("webgl");o.width=o.clientWidth*n,o.height=o.clientHeight*n;const s=new H({canvasId:"webgl",webGLcontextId:"webgl2"}),p=dt(),C=mt(),h=await lt("./Firefox.mp4"),g=document.getElementById("unmuteBtn");g&&g.addEventListener("click",()=>{h.muted=!1,g.textContent="ðŸ”Š å·²å–æ¶ˆé™éŸ³",g.disabled=!0,h.play().catch(d=>{console.warn("æ’­æ”¾å¤±è´¥:",d)})});const x={pipeline:{vertex:{glsl:e,wgsl:i},fragment:{glsl:t,wgsl:r},primitive:{topology:"triangle-list"},depthStencil:{depthCompare:"less-equal"}},vertices:{aVertexPosition:{format:"float32x3",data:p.position},aVertexNormal:{format:"float32x3",data:p.normal},aTextureCoord:{format:"float32x2",data:p.textureCoord}},indices:p.indices,draw:{__type__:"DrawIndexed",firstIndex:0,indexCount:36},bindingResources:{uSampler:C}},G={descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}],depthStencilAttachment:{depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},renderPassObjects:[x]};let V=0,P=0;function S(d){d*=.001;const I=d-V;V=d,ut(C.texture,h);const{projectionMatrix:T,modelViewMatrix:j,normalMatrix:O}=pt(a,I);u(x.bindingResources).uProjectionMatrix={value:T},u(x.bindingResources).uModelViewMatrix={value:j},u(x.bindingResources).uNormalMatrix={value:O};const W={commandEncoders:[{passEncoders:[G]}]};l.submit(W),s.submit(W),P===0&&(P++,k(s,l,o,a,0)),requestAnimationFrame(S)}requestAnimationFrame(S)});async function lt(e){const t=document.createElement("video");return t.loop=!0,t.autoplay=!0,t.muted=!0,t.src=e,await t.play().catch(i=>{console.warn("è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’:",i);const r=()=>{t.play().then(()=>{document.removeEventListener("click",r),document.removeEventListener("touchstart",r)}).catch(n=>{console.warn("æ’­æ”¾å¤±è´¥:",n)})};document.addEventListener("click",r,{once:!0}),document.addEventListener("touchstart",r,{once:!0})}),t}function dt(){const e=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],t=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],i=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],r=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{position:new Float32Array(e),normal:new Float32Array(t),textureCoord:new Float32Array(i),indices:new Uint16Array(r)}}function mt(){return{texture:{descriptor:{size:[1,1],format:"rgba8unorm"},sources:[{__type__:"TextureDataSource",size:[1,1],data:new Uint8Array([0,0,255,255])}]},sampler:{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"linear"}}}function ut(e,t){(e.descriptor.size[0]!==t.videoWidth||e.descriptor.size[1]!==t.videoHeight)&&(u(e.descriptor).size=[t.videoWidth,t.videoHeight]),u(e).sources=[{image:t}]}function pt(e,t){const i=45*Math.PI/180,r=e.clientWidth/e.clientHeight,n=.1,a=100,l=v();Z(l,i,r,n,a);const o=v();$(o,o,[-0,0,-6]),E(o,o,b,[0,0,1]),E(o,o,b*.7,[0,1,0]);const s=v();return tt(s,o),et(s,s),b+=t,{projectionMatrix:l,modelViewMatrix:o,normalMatrix:s}}
