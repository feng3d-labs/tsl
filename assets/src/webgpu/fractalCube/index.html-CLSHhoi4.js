import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{a as W,d as O,v as _,u as f,e as G,c,b as R,g as z,h as E,f as q,W as B,r as C}from"../../../builtins-C5GxhwDd.js";import{W as H,a as U}from"../../../frame-comparison-CBkPASci.js";import{v as x}from"../../../var-BrV_KNjZ.js";import{s as N}from"../../../sampler2D-DSRZ_QT6.js";import{t as k}from"../../../texture2D-DxhDwbSP.js";import{r as J}from"../../../return-DhHkPme9.js";import{m as L}from"../../../mat4-Pkjqt0vg.js";import{c as M,p as K,t as Q,h as S}from"../../../mat4-Lq7FX_53.js";import"../../../wgslKeywords-TYZDccpG.js";import"../../../common-C8IKy_GC.js";const F=W("aVertexPosition",O()),X=W("aTextureCoord",_()),Y=f("uModelViewMatrix",L(),0,0),Z=f("uProjectionMatrix",L(),0,1),T=G("vTextureCoord",_()),I=G("vFragPosition",c()),p=R("main",()=>{const e=x("position",c(F,1));z.assign(Z.multiply(Y).multiply(e)),T.assign(X);const r=x("fragPos",E(.5).multiply(c(F,1).add(c(1))));I.assign(r)}),V=q("main",()=>{const e=N(f("uSampler")),r=x("color1",k(e,T).multiply(I));J(r)});let g=0;$();async function $(){const e=p.toGLSL(2),r=V.toGLSL(2),n=p.toWGSL(),l=V.toWGSL(p),i=window.devicePixelRatio||1,s=navigator.gpu.getPreferredCanvasFormat(),t=document.getElementById("webgpu");t.width=t.clientWidth*i,t.height=t.clientHeight*i;const o=await new H({canvasId:"webgpu",configuration:{format:s}}).init(),a=document.getElementById("webgl");a.width=a.clientWidth*i,a.height=a.clientHeight*i;const w=new B({canvasId:"webgl",webGLcontextId:"webgl2"}),d=tt(),h={texture:{descriptor:{size:[t.width,t.height],format:s}},sampler:{}},m={pipeline:{vertex:{glsl:e,wgsl:n},fragment:{glsl:r,wgsl:l},primitive:{topology:"triangle-list"},depthStencil:{depthCompare:"less-equal"}},vertices:{aVertexPosition:{format:"float32x3",data:d.position},aTextureCoord:{format:"float32x2",data:d.textureCoord}},indices:d.indices,draw:{__type__:"DrawIndexed",firstIndex:0,indexCount:36},bindingResources:{uSampler:h}},v={commandEncoders:[{passEncoders:[{descriptor:{colorAttachments:[{clearValue:[.5,.5,.5,1],loadOp:"clear"}],depthStencilAttachment:{depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},renderPassObjects:[m]},{__type__:"CopyTextureToTexture",source:{texture:null},destination:{texture:h.texture},copySize:[t.width,t.height]}]}]};let b=0,P=0;function y(){let u=Date.now();u*=.001;const j=u-b;b=u;const{projectionMatrix:A,modelViewMatrix:D}=et(t,j);C(m.bindingResources).uProjectionMatrix={value:A},C(m.bindingResources).uModelViewMatrix={value:D},o.submit(v),w.submit(v),P===0&&(P++,U(w,o,a,t,0)),requestAnimationFrame(y)}requestAnimationFrame(y)}function tt(){const e=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],r=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{position:new Float32Array(e),textureCoord:new Float32Array(r),indices:new Uint16Array(n)}}function et(e,r){const n=45*Math.PI/180,l=e.clientWidth/e.clientHeight,i=.1,s=100,t=M();K(t,n,l,i,s);const o=M();return Q(o,o,[-0,0,-6]),S(o,o,g,[0,0,1]),S(o,o,g*.7,[0,1,0]),g+=r,{projectionMatrix:t,modelViewMatrix:o}}
